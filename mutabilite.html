

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="fr" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="fr" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.4. Mutabilité &mdash; Documentation CoursPythonCPGE </title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="3.5. Dictionnaires" href="dictionnaires.html" />
    <link rel="prev" title="3.3. Chaînes de caractère" href="chaines.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CoursPythonCPGE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="io.html">1. Entrée/sortie</a></li>
<li class="toctree-l1"><a class="reference internal" href="types_operateurs_variables.html">2. Types, opérateurs et variables</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="types_composes.html">3. Types composés</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="listes.html">3.1. Listes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuples.html">3.2. Tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="chaines.html">3.3. Chaînes de caractère</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.4. Mutabilité</a></li>
<li class="toctree-l2"><a class="reference internal" href="dictionnaires.html">3.5. Dictionnaires</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="algorithmique.html">4. Rudiments d’algorithmique</a></li>
<li class="toctree-l1"><a class="reference internal" href="theorie.html">5. Un peu de théorie</a></li>
<li class="toctree-l1"><a class="reference internal" href="recursivite.html">6. Récursivité</a></li>
<li class="toctree-l1"><a class="reference internal" href="algoclassiques.html">7. Algorithmes classiques</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CoursPythonCPGE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="types_composes.html">3. Types composés</a> &raquo;</li>
        
      <li>3.4. Mutabilité</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/mutabilite.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mutabilite">
<h1>3.4. Mutabilité<a class="headerlink" href="#mutabilite" title="Lien permanent vers ce titre">¶</a></h1>
<p>Il s’agit d’un paragraphe un peu subtil : il s’agit d’expliquer la différence fondamentale qu’il existe en Python entre les objets que l’on peut modifier (listes) ou que l’on ne peut modifier (tuples ou chaînes de caractère).</p>
<p>Considérons ce premier exemple où les variables sont des entiers.</p>
<pre class="literal-block">In [1]: a = 1

In [2]: b = a

In [3]: a = 2           # on modifie a

In [4]: a
Out[4]: 2

In [5]: b               # b n'a pas ete modifiée
Out[5]: 1</pre>
<p>Considérons maintenant l’exemple suivant où les variables sont des listes.</p>
<pre class="literal-block">In [6]: a = [1, 2, 3]

In [7]: b = a

In [8]: a[0] = 'foo'    # on modifie la liste a

In [9]: a
Out[9]: ['foo', 2, 3]

In [10]: b               # la liste b a aussi ete modifiée !
Out[10]: ['foo', 2, 3]</pre>
<p>Pour expliquer la différence entre ces deux exemples, il faut comprendre la représentation des objets Python en mémoire. Pour cela, on va utiliser la fonction <code class="code docutils literal notranslate"><span class="pre">id</span></code>. Pour schématiser, celle-ci renvoie l’emplacement en mémoire d’un objet.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

<span class="gp">In [12]: </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>

<span class="gp">In [13]: </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>    <span class="c1"># les variables a et b pointent vers le même emplacement en mémoire</span>
<span class="gh">Out[13]: </span><span class="go">(140716654813840, 140716654813840)</span>

<span class="gp">In [14]: </span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>

<span class="gp">In [15]: </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>    <span class="c1"># la variable b pointe toujours vers le même emplacement mais plus la variable b</span>
<span class="gh">Out[15]: </span><span class="go">(140716654813872, 140716654813840)</span>
</pre></div>
</div>
<p>L’instruction <code class="code docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">2</span></code> a fait pointer la variable <code class="code docutils literal notranslate"><span class="pre">a</span></code> vers un autre emplacement en mémoire où est stocké l’entier <code class="code docutils literal notranslate"><span class="pre">2</span></code>.</p>
<div class="figure">
<p><img src="_images/tikz-f2d2252bd04a9cd1f9d1fd0bef887535aa496701.png" alt="\node[rectangle,draw,pin={[draw,circle]120:b},pin={[draw,circle]240:a}](before){1};
\node[rectangle,draw,pin={[draw,circle]60:b}](b after)[right=5cm of before]{1};
\node[rectangle,draw,pin={[draw,circle]-60:a}](a after)[below=1cm of b after]{2};
\draw[-fast cap,shorten &lt;=10pt,shorten &gt;=10pt,&gt;=latex, blue!20!white, line width=10pt](before) -- (b after);" /></p>
</div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="gp">In [17]: </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>

<span class="gp">In [18]: </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>    <span class="c1"># les variables a et b pointent vers le même emplacement en mémoire</span>
<span class="gh">Out[18]: </span><span class="go">(1835800432136, 1835800432136)</span>

<span class="gp">In [19]: </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>

<span class="gp">In [20]: </span><span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>    <span class="c1"># les variables a et b pointent toujours vers le même emplacement</span>
<span class="gh">Out[20]: </span><span class="go">(1835800432136, 1835800432136)</span>
</pre></div>
</div>
<p>Ici, l’instruction <code class="code docutils literal notranslate"><span class="pre">a[0]</span> <span class="pre">=</span> <span class="pre">'foo'</span></code> a modifié l’objet stocké à l’emplacement commun vers lequel pointent les variables <code class="code docutils literal notranslate"><span class="pre">a</span></code> et <code class="code docutils literal notranslate"><span class="pre">b</span></code>. Comme <code class="code docutils literal notranslate"><span class="pre">a</span></code> et <code class="code docutils literal notranslate"><span class="pre">b</span></code> pointent toujours le même emplacement en mémoire, la variable <code class="code docutils literal notranslate"><span class="pre">b</span></code> est maintenant associée à ce nouvel objet.</p>
<div class="figure">
<p><img src="_images/tikz-72806e22283cd01e6bb9fad0bf77c3e547a88556.png" alt="\node[rectangle,draw,pin={[draw,circle]120:b},pin={[draw,circle]240:a}](before){[1, 2, 3]};
\node[rectangle,draw,pin={[draw,circle]60:b},pin={[draw,circle]-60:a}](after)[right=5cm of before]{['foo', 2, 3]};
\draw[-fast cap,shorten &lt;=10pt,shorten &gt;=10pt,&gt;=latex, blue!20!white, line width=10pt](before) -- (after);" /></p>
</div><p>Mais pourquoi cette différence de comportement ? Il existe en Python deux types d’objets : les objets <strong>mutables</strong> et les objets <strong>immutables</strong>. On peut donner la définition suivante.</p>
<blockquote>
<div><p>Un objet est dit <strong>mutable</strong> si on peut changer sa valeur après sa création. Il est dit <strong>immutable</strong> dans le cas contraire <a class="footnote-reference brackets" href="#immutable" id="id1">1</a>.</p>
</div></blockquote>
<dl class="simple">
<dt>Objets immutables</dt><dd><p>Entiers, flottants, complexes, tuples, chaînes de caractères, …</p>
</dd>
<dt>Objets mutables</dt><dd><p>Listes, dictionnaires, …</p>
</dd>
</dl>
<p>Voilà la solution du mystère : toutes les variables pointant vers un même objet mutable sont affectées par la modification de cet objet. Ceci ne peut pas se produire lorsque des variables pointent vers un objet immutable puisque celui-ci ne peut-être modifié.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bien souvent, on veut copier une liste dans un nouvel objet pour qu’il ne subisse pas les modifications de l’objet initial. Pour cela, il ya plusieurs possibilités :</p>
<blockquote>
<div><ul class="simple">
<li><p>le slicing <code class="code docutils literal notranslate"><span class="pre">[:]</span></code> ;</p></li>
<li><p>l’utilisation de la méthode <code class="code docutils literal notranslate"><span class="pre">copy</span></code> ;</p></li>
<li><p>l’utilisation du constructeur <code class="code docutils literal notranslate"><span class="pre">list</span></code>.</p></li>
</ul>
</div></blockquote>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">liste1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="gp">In [22]: </span><span class="n">liste2</span> <span class="o">=</span> <span class="n">liste1</span><span class="p">[:]</span>

<span class="gp">In [23]: </span><span class="n">liste3</span> <span class="o">=</span> <span class="n">liste1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [24]: </span><span class="n">liste4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">liste1</span><span class="p">)</span>

<span class="gp">In [25]: </span><span class="nb">id</span><span class="p">(</span><span class="n">liste1</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">liste2</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">liste3</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">liste4</span><span class="p">)</span>  <span class="c1"># les objets sont bien distincts</span>
<span class="gh">Out[25]: </span><span class="go">(1835801807624, 1835800088008, 1835799545480, 1835793375560)</span>

<span class="gp">In [26]: </span><span class="n">liste1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;toto&#39;</span>

<span class="gp">In [27]: </span><span class="n">liste1</span><span class="p">,</span> <span class="n">liste2</span><span class="p">,</span> <span class="n">liste3</span><span class="p">,</span> <span class="n">liste4</span>                  <span class="c1"># liste1 a ete modifiée mais pas les autres listes</span>
<span class="gh">Out[27]: </span><span class="go">([&#39;toto&#39;, 2, 3], [1, 2, 3], [1, 2, 3], [1, 2, 3])</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">À faire</p>
<p>constructeur dans glossaire</p>
</div>
</div>
<p class="rubric">Les opérateurs <code class="code docutils literal notranslate"><span class="pre">+</span></code> et <code class="code docutils literal notranslate"><span class="pre">+=</span></code></p>
<p>Le lecteur attentif aura remarqué qu’on semblerait pouvoir modifier un objet immutable telle qu’une chaîne de caractères ou une liste à l’aide des opérateurs <code class="code docutils literal notranslate"><span class="pre">+</span></code> ou <code class="code docutils literal notranslate"><span class="pre">+=</span></code>. Mais ces opérateurs ne modifient pas l’objet en question ; ils créent en fait un <strong>nouvel</strong> objet. On peut s’en convaincre à l’aide de la fonction <code class="code docutils literal notranslate"><span class="pre">id</span></code>.</p>
<pre class="literal-block">In [28]: t = (1, 2, 3)

In [29]: id(t)
Out[29]: 1835793301936

In [30]: t = t + (4, 5)

In [31]: t
Out[31]: (1, 2, 3, 4, 5)

In [32]: id(t)
Out[32]: 1835794899808</pre>
<pre class="literal-block">In [33]: t = (1, 2, 3)

In [34]: id(t)
Out[34]: 1835793105256

In [35]: t += (4, 5)

In [36]: t
Out[36]: (1, 2, 3, 4, 5)

In [37]: id(t)
Out[37]: 1835740050800</pre>
<p>Pour les objets mutables tels que les listes, les opérateurs <code class="code docutils literal notranslate"><span class="pre">+</span></code> et <code class="code docutils literal notranslate"><span class="pre">+=</span></code> se comportent de manières différentes : l’opérateur <code class="code docutils literal notranslate"><span class="pre">+</span></code> crée un nouvel objet tandis que l’opérateur <code class="code docutils literal notranslate"><span class="pre">+=</span></code> modifie l’objet initial.</p>
<pre class="literal-block">In [38]: liste1 = [1, 2, 3]

In [39]: liste2 = liste1

In [40]: liste1 = liste1 + [4, 5]

In [41]: liste1, liste2          # seule liste1 a ete modifiée
Out[41]: ([1, 2, 3, 4, 5], [1, 2, 3])

In [42]: id(liste1), id(liste2)  # c'est normal : liste1 et liste2 pointent vers des objets distincts
Out[42]: (1835800996040, 1835802065608)</pre>
<pre class="literal-block">In [43]: liste1 = [1, 2, 3]

In [44]: liste2 = liste1

In [45]: liste1 += [4, 5]

In [46]: liste1, liste2          # liste1 et liste2 ont ete modifiées
Out[46]: ([1, 2, 3, 4, 5], [1, 2, 3, 4, 5])

In [47]: id(liste1), id(liste2)  # c'est normal : liste1 et liste2 pointent vers le même objet
Out[47]: (1835802016904, 1835802016904)</pre>
<p class="rubric">Egalité structurelle ou physique</p>
<p>On a vu que l’opérateur <code class="code docutils literal notranslate"><span class="pre">==</span></code> permettait de tester si deux objets étaient égaux. Mais de quel type d’égalité parle-t-on alors ? L’opérateur <code class="code docutils literal notranslate"><span class="pre">==</span></code> teste si deux objets ont la même <strong>valeur</strong> sans pour autant qu’il partage le même emplacement en mémoire. On parle alors d'<strong>égalité structurelle</strong>.</p>
<p>Lorsque « deux » objets sont en fait identiques (c’est-à-dire lorsqu’ils ont le même emplacement en mémoire), on parle d'<strong>égalité physique</strong>. Pour tester l’égalité physique, on peut comparer les emplacements en mémoire à l’aide de la fonction <code class="code docutils literal notranslate"><span class="pre">id</span></code> ou plus simplement utiliser l’opérateur <code class="code docutils literal notranslate"><span class="pre">is</span></code>.</p>
<pre class="literal-block">In [48]: liste1 = [1, 2, 3]

In [49]: liste2 = liste1

In [50]: liste3 = liste1[:]

In [51]: liste1, liste2, liste3
Out[51]: ([1, 2, 3], [1, 2, 3], [1, 2, 3])

In [52]: id(liste1), id(liste2), id(liste3)
Out[52]: (1835802108296, 1835802108296, 1835802108936)

In [53]: liste2 == liste1, liste3 == liste1
Out[53]: (True, True)

In [54]: liste2 is liste1, liste3 is liste1
Out[54]: (True, False)</pre>
<p>Un exemple peut-être un peu plus surprenant.</p>
<pre class="literal-block">In [55]: [1, 2, 3] == [1, 2, 3]
Out[55]: True

In [56]: [1, 2, 3] is [1, 2, 3]
Out[56]: False</pre>
<p>Python a en fait stocké deux versions de la liste <code class="code docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> dans deux emplacements en mémoire distincts.</p>
<hr class="docutils" />
<p>On termine par un cas plus vicieux que les deux exemples initiaux et qui peut faire passer des nuits blanches au programmeur débutant en Python.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>

<span class="gp">In [58]: </span><span class="n">a</span>
<span class="gh">Out[58]: </span><span class="go">[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]</span>

<span class="gp">In [59]: </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># on pense n&#39;avoir modifié qu&#39;un élément de la liste de listes a</span>

<span class="gp">In [60]: </span><span class="n">a</span>               <span class="c1"># en fait non...</span>
<span class="gh">Out[60]: </span><span class="go">[[1, 0, 0], [1, 0, 0], [1, 0, 0], [1, 0, 0]]</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<dl class="footnote brackets">
<dt class="label" id="immutable"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Ce n’est pas rigoureusement exact. Un objet immutable tel qu’un tuple peut contenir des objets mutables comme des listes. Néanmoins, chaque objet du tuple conserve le même emplacement en mémoire même s’il a été modifié.</p>
<pre class="literal-block">In [61]: a = ([1, 2, 3], 'toto', 'tata')

In [62]: b = a

In [63]: a[0][1] = 1000

In [64]: a
Out[64]: ([1, 1000, 3], 'toto', 'tata')

In [65]: b                   # b a egalement ete modifié
Out[65]: ([1, 1000, 3], 'toto', 'tata')

In [66]: id(a[0]), id(b[0])  # le premier élément du tuple est toujours le même
Out[66]: (1835802183112, 1835802183112)</pre>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dictionnaires.html" class="btn btn-neutral float-right" title="3.5. Dictionnaires" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="chaines.html" class="btn btn-neutral float-left" title="3.3. Chaînes de caractère" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Laurent Garcin

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>